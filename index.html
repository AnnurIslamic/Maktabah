<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maktabah Hadits Digital - API Indonesia</title>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Poppins:wght@400;600&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Noto+Naskh+Arabic:wght@400;700&display=swap');

        :root {
            --primary-bg: #0f172a; --secondary-bg: #1e293b; --card-bg: #334155;
            --text-light: #f1f5f9; --text-dark: #94a3b8; --accent-gold: #f59e0b;
            --navbar-height: 70px; --font-body: 'Poppins', sans-serif;
            --font-title: 'Merriweather', serif; --font-arabic: 'Noto Naskh Arabic', serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-body); background-color: var(--primary-bg);
            color: var(--text-light); padding-top: var(--navbar-height);
        }
        
        /* Navbar Styles */
        nav {
            position: fixed; top: 0; left: 0; width: 100%; min-height: var(--navbar-height);
            background-color: rgba(15, 23, 42, 0.85); backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--card-bg);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 1rem; z-index: 1000; flex-wrap: wrap;
        }
        .nav-brand { font-family: var(--font-title); font-size: 1.5rem; color: var(--accent-gold); padding: 1rem 0; }
        .nav-toggle { display: block; cursor: pointer; background: none; border: none; }
        .nav-toggle svg { width: 30px; height: 30px; color: var(--text-light); }
        .nav-menu {
            list-style: none; width: 100%; display: none;
            flex-direction: column; align-items: center; gap: 0.5rem; padding: 1rem 0;
        }
        .nav-menu.active { display: flex; }
        .nav-menu a {
            color: var(--text-dark); text-decoration: none; font-weight: 600;
            padding: 0.8rem; border-bottom: 2px solid transparent; width: 100%; text-align: center;
            transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; gap: 0.5rem;
        }
        .nav-menu a:hover { color: var(--text-light); background-color: var(--card-bg); border-radius: 8px;}
        .nav-menu a.active { color: var(--accent-gold); }
        .search-container { width: 100%; margin-top: 1rem; }
        #search-input { width: 100%; background-color: var(--secondary-bg); border: 1px solid var(--card-bg); padding: 0.8rem; border-radius: 8px; color: var(--text-light); font-size: 1rem; }

        /* Desktop Responsiveness */
        @media (min-width: 820px) {
            nav { flex-wrap: nowrap; padding: 0 2rem; }
            .nav-toggle { display: none; }
            .nav-menu { display: flex; flex-direction: row; width: auto; padding: 0; background: none; border: none; }
            .nav-menu a { width: auto; padding: 0.5rem 0; }
            .nav-menu a:hover { background: none; }
            .nav-menu a.active { border-bottom-color: var(--accent-gold); }
            .search-container { display: flex; width: auto; margin-top: 0; background-color: var(--card-bg); border-radius: 8px; padding: 0.5rem 0.8rem; }
            #search-input { width: 180px; padding: 0; background: none; border: none; }
        }

        /* Konten & Views */
        main { animation: fadeIn 0.5s ease-in-out; }
        .view { display: none; padding: 1.5rem; }
        .view.active { display: block; }
        .view-header { margin-bottom: 2rem; text-align: center; }
        .view-header h2 { font-family: var(--font-title); font-size: 2.2rem; color: var(--accent-gold); }
        .bookshelf { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 1.5rem; max-width: 1200px; margin: 0 auto; }
        .book-card { background: var(--secondary-bg); border-radius: 8px; border: 1px solid var(--card-bg); text-align: center; padding: 1.5rem; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .book-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .hadith-card { background-color: var(--secondary-bg); border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; border: 1px solid var(--card-bg); position: relative; }
        .arabic-text { font-family: var(--font-arabic); font-size: 1.8rem; text-align: right; line-height: 2; margin: 1rem 0; }
        .book-card h3, .hadith-card h3 { font-family: var(--font-title); }
        .hadith-card h3 { font-size: 1.1rem; color: var(--text-light); margin-bottom: 0.5rem; padding-right: 3rem;}
        .hadith-info { font-size: 0.9rem; color: var(--text-dark); margin-bottom: 1rem; }
        .favorite-button { position: absolute; top: 1.5rem; right: 1rem; font-size: 1.8rem; cursor: pointer; background: none; border: none; padding: 0; }
        .empty-state { text-align: center; padding: 3rem 1rem; background-color: var(--secondary-bg); border-radius: 12px; border: 2px dashed var(--card-bg); }
        .translation { background-color: var(--card-bg); padding: 1rem; border-radius: 8px; border-left: 4px solid var(--accent-gold); font-style: italic; }
        
        .home-view-detailed { display: flex; align-items: center; justify-content: center; min-height: calc(100vh - var(--navbar-height)); padding: 2rem; }
        .home-content { display: flex; align-items: center; justify-content: center; gap: 3rem; max-width: 1200px; width: 100%; }
        .home-text { flex-basis: 50%; max-width: 550px; animation: fadeIn 0.8s ease-in-out; }
        .home-text h1 { font-family: var(--font-title); font-size: 2.8rem; line-height: 1.3; margin-bottom: 1rem; }
        .home-text .subtitle { font-size: 1.1rem; color: var(--text-dark); margin-bottom: 2rem; }
        .home-3d-model { flex-basis: 50%; min-height: 50vh; display: flex; align-items: center; justify-content: center; }
        .feature-list { list-style: none; margin-bottom: 2.5rem; }
        .feature-list li { display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem; }
        .feature-list svg { width: 30px; height: 30px; color: var(--accent-gold); flex-shrink: 0; }
        .feature-list div { display: flex; flex-direction: column; }
        .feature-list strong { font-size: 1.1rem; font-weight: 600; color: var(--text-light); }
        .feature-list span { color: var(--text-dark); }
        .cta-button { background-color: var(--accent-gold); color: var(--primary-bg); border: none; border-radius: 8px; padding: 1rem 2rem; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .cta-button:hover { transform: translateY(-3px); box-shadow: 0 8px 15px rgba(245, 158, 11, 0.2); }
        
        .hadith-explanation { margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid var(--card-bg); }
        .hadith-explanation strong { color: var(--accent-gold); display: block; margin-bottom: 0.5rem; }
        .hadith-explanation p { font-size: 0.95rem; color: var(--text-dark); line-height: 1.6; }
        
        .loader { text-align: center; padding: 3rem; font-size: 1.2rem; color: var(--text-dark); }

        @media (max-width: 820px) {
            .home-view-detailed { height: auto; padding: 2rem 1.5rem; }
            .home-content { flex-direction: column; text-align: center; }
            .home-text h1 { font-size: 2.2rem; }
            .feature-list li { text-align: left; }
            .home-3d-model { min-height: 40vh; width: 100%; margin-top: 2rem; }
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>
</head>
<body>
    <nav id="navbar">
        <div class="nav-brand">Maktabah</div>
        <button class="nav-toggle" id="nav-toggle" aria-label="Buka menu">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg>
        </button>
        <div class="nav-menu" id="nav-menu">
            <ul>
                <li><a href="#" class="nav-link active" data-view="home">Home</a></li>
                <li><a href="#" class="nav-link" data-view="kitab">Pilih Kitab</a></li>
                <li><a href="#" class="nav-link" data-view="favorit">Favorit</a></li>
            </ul>
        </div>
    </nav>

    <main>
        <div id="view-home" class="view active home-view-detailed">
            <div class="home-content">
                <div class="home-text">
                    <h1>Selamat Datang di <span style="color: var(--accent-gold);">Maktabah Digital</span></h1>
                    <p class="subtitle">Sebuah platform modern untuk memudahkan Anda dalam mempelajari, merenungi, dan menyimpan hadits-hadits shahih dari Nabi Muhammad Ô∑∫.</p>
                    <ul class="feature-list">
                        <li><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" /></svg><div><strong>Rak Buku Digital</strong><span>Jelajahi hadits berdasarkan kitab aslinya.</span></div></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" /></svg><div><strong>Pencarian Cepat</strong><span>Temukan hadits di semua kitab secara instan.</span></div></li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" /></svg><div><strong>Koleksi Favorit</strong><span>Simpan hadits yang berkesan untuk dibaca kembali.</span></div></li>
                    </ul>
                    <button class="cta-button" id="start-exploring-btn">Mulai Menjelajahi</button>
                </div>
                <div class="home-3d-model">
                    <model-viewer src="https://modelviewer.dev/shared-assets/models/Book-of-Spells.glb" alt="Model 3D sebuah kitab" shadow-intensity="1" camera-controls auto-rotate environment-image="neutral" touch-action="pan-y"></model-viewer>
                </div>
            </div>
        </div>
        
        <div id="view-kitab" class="view"></div>
        <div id="view-favorit" class="view"></div>
    </main>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
    
        // --- KONFIGURASI & VARIABEL GLOBAL ---
        const API_BASE_URL = 'https://hadith-api.gading.dev/';

        let narrators = []; // Menyimpan daftar perawi (kitab)
        let currentHadiths = []; // Menyimpan cache hadits yang sedang ditampilkan
        let favoriteHadiths = JSON.parse(localStorage.getItem('favoriteHadiths')) || [];
        
        // --- ELEMEN-ELEMEN PENTING ---
        const navToggle = document.getElementById('nav-toggle');
        const navMenu = document.getElementById('nav-menu');
        const views = document.querySelectorAll('.view');
        const navLinks = document.querySelectorAll('.nav-link');
        const startExploringBtn = document.getElementById('start-exploring-btn');

        // --- FUNGSI-FUNGSI API ---
        const callApi = async (endpoint) => {
            const url = `${API_BASE_URL}${endpoint}`;
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Gagal mengambil data: Server merespon dengan status ${response.status}`);
                }
                const data = await response.json();
                if(!data.data){ // Check if the expected data structure is there
                    throw new Error("Format data dari API tidak sesuai.");
                }
                return data;
            } catch (error) {
                console.error('Terjadi kesalahan API:', error);
                throw error;
            }
        };
        
        // --- FUNGSI TAMPILAN ---
        const showLoader = (container, message) => {
            container.innerHTML = `<div class="loader">${message}</div>`;
        };
        
        const showError = (container, message) => {
            container.innerHTML = `<div class="empty-state"><p>${message}</p></div>`;
        };

        const renderBookshelf = async () => {
            const container = document.getElementById('view-kitab');
            if (narrators.length > 0) {
                container.innerHTML = `<div class="view-header"><h2>Pilih Kitab</h2></div><div class="bookshelf"></div>`;
                const bookshelf = container.querySelector('.bookshelf');
                narrators.forEach(narrator => {
                    const bookCard = document.createElement('div');
                    bookCard.className = 'book-card';
                    bookCard.innerHTML = `<h3>${narrator.name}</h3><p>${narrator.total} Hadits</p>`;
                    bookCard.addEventListener('click', () => renderHadithList(narrator.slug));
                    bookshelf.appendChild(bookCard);
                });
            } else {
                showLoader(container, 'Memuat daftar kitab...');
                try {
                    const data = await callApi('books');
                    narrators = data.data;
                    renderBookshelf();
                } catch (error) {
                    showError(container, `Gagal memuat kitab. Periksa koneksi internet Anda atau coba lagi nanti. (${error.message})`);
                }
            }
        };

        const renderHadithList = async (narratorSlug) => {
            const isFavoritView = narratorSlug === 'favorit';
            const container = isFavoritView ? document.getElementById('view-favorit') : document.getElementById('view-kitab');
            let headerTitle = '';
            let backButton = '';

            if (isFavoritView) {
                headerTitle = 'Favorit Anda';
                container.innerHTML = `<div class="view-header"><h2>${headerTitle}</h2></div><div class="list-container"></div>`;
                const listContainer = container.querySelector('.list-container');
                if (favoriteHadiths.length === 0) {
                    listContainer.innerHTML = `<div class="empty-state"><p>Tidak ada hadits untuk ditampilkan.</p></div>`;
                } else {
                    favoriteHadiths.forEach(h => listContainer.appendChild(createHadithCard(h)));
                }
            } else { // Tampilan kitab spesifik
                const narrator = narrators.find(n => n.slug === narratorSlug);
                headerTitle = narrator ? narrator.name : '';
                backButton = `<div id="back-to-bookshelf" style="cursor:pointer; color: var(--text-dark); margin-bottom: 1rem;">‚Üê Kembali ke Rak Buku</div>`;
                container.innerHTML = `<div class="view-header">${backButton}<h2>${headerTitle}</h2></div><div class="list-container"></div>`;
                const listContainer = container.querySelector('.list-container');
                showLoader(listContainer, `Memuat hadits dari ${headerTitle}...`);
                try {
                    // Ambil 300 hadits pertama
                    const data = await callApi(`books/${narratorSlug}?range=1-300`);
                    currentHadiths = data.data.hadiths.map(h => ({...h, narrator: narrator.name})); // Tambahkan nama perawi ke setiap hadits
                    listContainer.innerHTML = ''; // Hapus loader
                    currentHadiths.forEach(h => listContainer.appendChild(createHadithCard(h)));
                } catch (error) {
                    showError(listContainer, `Gagal memuat hadits. ${error.message}`);
                }
            }

            if(container.querySelector('#back-to-bookshelf')) {
                container.querySelector('#back-to-bookshelf').addEventListener('click', renderBookshelf);
            }
        };

        const createHadithCard = (h) => {
            const isFavorite = favoriteHadiths.some(fav => fav.number === h.number && fav.narrator === h.narrator);
            const card = document.createElement('div');
            card.className = 'hadith-card';
            
            // Siapkan data dengan teks pengganti
            const narratorName = h.narrator ? h.narrator : 'Unknown';
            const arabicText = h.arab || 'Teks Arab tidak tersedia.';
            const indonesianText = h.id || 'Terjemahan Indonesia tidak tersedia.';
            const englishText = h.en || 'English translation not available.';

            card.innerHTML = `
                <button class="favorite-button" data-number='${h.number}' data-narrator='${narratorName}'>${isFavorite ? '‚ù§Ô∏è' : 'ü§ç'}</button>
                <h3>Hadits no. ${h.number}</h3>
                <div class="hadith-info">HR. ${narratorName}</div>
                <p class="arabic-text" dir="rtl">${arabicText}</p>
                <div class="hadith-explanation">
                    <strong>üìú English Translation:</strong>
                    <p style="font-style: italic; color: var(--text-dark);">${englishText}</p>
                </div>
                <blockquote class="translation"><strong>ID:</strong> ${indonesianText}</blockquote>
            `;
            card.querySelector('.favorite-button').addEventListener('click', (e) => {
                e.stopPropagation();
                const hadithData = {
                    number: h.number,
                    narrator: narratorName,
                    arab: h.arab,
                    id: h.id,
                    en: h.en
                };
                toggleFavorite(hadithData);
                e.target.innerHTML = favoriteHadiths.some(fav => fav.number === h.number && fav.narrator === narratorName) ? '‚ù§Ô∏è' : 'ü§ç';
            });
            return card;
        };
        
        // --- FUNGSI LOGIKA ---
        const toggleFavorite = (hadith) => {
            const index = favoriteHadiths.findIndex(fav => fav.number === hadith.number && fav.narrator === hadith.narrator);
            if (index > -1) {
                favoriteHadiths.splice(index, 1);
            } else {
                favoriteHadiths.push(hadith);
            }
            localStorage.setItem('favoriteHadiths', JSON.stringify(favoriteHadiths));
        };
        
        const navigateTo = (viewId) => {
            views.forEach(view => view.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            navLinks.forEach(link => link.classList.toggle('active', link.dataset.view === viewId.replace('view-', '')));
            if (navMenu.classList.contains('active')) navMenu.classList.remove('active');
            
            if (viewId === 'view-kitab') renderBookshelf();
            if (viewId === 'view-favorit') renderHadithList('favorit');
        };
        
        // --- EVENT LISTENERS ---
        if(startExploringBtn){
            startExploringBtn.addEventListener('click', () => navigateTo('view-kitab'));
        }
        navToggle.addEventListener('click', () => navMenu.classList.toggle('active'));
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                navigateTo('view-' + e.currentTarget.dataset.view);
            });
        });

        // --- INISIALISASI ---
        navigateTo('view-home');
    });
    </script>
</body>
</html>
